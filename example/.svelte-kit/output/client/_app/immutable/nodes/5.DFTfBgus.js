import{s as Nt,c as Et,a as u,r as At,d as Lt,f as b,i as R,b as p}from"../chunks/CDtJAJDW.js";import{p as Ve,f as Ot,n as Dt,c as Ye,J as P,K as me,t as Ft,L as Gt,A as i,F as M,x as e,M as h,I as f,d as Pt,B as a,u as ze,$ as Ut,D as r,G as U,N as jt}from"../chunks/43DoFiGK.js";import{I as zt,s as Wt,e as We,a as I,b as ge,i as Be,c as N}from"../chunks/B5-rS708.js";import{h as Bt}from"../chunks/D3R2J86X.js";import{s as V,g as He,c as Je}from"../chunks/DugyTYfm.js";import{B as Ht}from"../chunks/DnayzfWM.js";function Jt(E,S,w,k){let m=null,_=null;function d(){try{m=new WebSocket(E),m.onopen=()=>{w?.()},m.onmessage=y=>{try{const j=JSON.parse(y.data);S(j)}catch{}},m.onclose=()=>{k?.(),_=setTimeout(d,2e3)},m.onerror=()=>{}}catch(y){console.error("[WS] Connection failed:",y),_=setTimeout(d,2e3)}}return d(),{close:()=>{_&&clearTimeout(_),m&&m.close()}}}function Vt(E,S){Ve(S,!0);let w=At(S,["$$slots","$$events","$$legacy"]);const k=[["line",{x1:"12",x2:"12",y1:"2",y2:"22"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"}]];zt(E,Nt({name:"dollar-sign"},()=>w,{get iconNode(){return k},children:(m,_)=>{var d=Et(),y=Ot(d);Wt(y,()=>S.children??Dt),u(m,d)},$$slots:{default:!0}})),Ye()}var Yt=b('<span class="text-sm text-emerald-400 font-medium svelte-fo0yqp"> </span>'),Kt=b('<button class="px-3 py-1.5 text-xs font-medium text-red-400 hover:text-red-300 bg-red-500/10 hover:bg-red-500/20 border border-red-500/30 hover:border-red-500/50 rounded-lg transition-all svelte-fo0yqp">Cancel All</button>'),Xt=b('<div class="absolute inset-0 rounded-xl opacity-30 svelte-fo0yqp"></div>'),Qt=b('<div class="text-xs text-yellow-400 mt-1 svelte-fo0yqp"> </div>'),Zt=b('<div class="text-xs text-green-400 mt-1 svelte-fo0yqp">FREE</div>'),es=b('<span class="text-xs text-yellow-400 font-semibold svelte-fo0yqp"> </span>'),ts=b('<div class="bg-black/70 rounded p-2 border border-cyan-500/50 relative overflow-hidden svelte-fo0yqp"><div class="absolute inset-0 opacity-10 svelte-fo0yqp"></div> <div class="flex items-center justify-between mb-1 relative z-10 svelte-fo0yqp"><div class="flex items-center gap-2 svelte-fo0yqp"><div class="w-2 h-2 rounded-full bg-cyan-500 animate-pulse svelte-fo0yqp"></div> <div class="text-xs font-mono svelte-fo0yqp"><span class="text-cyan-400 svelte-fo0yqp">Miner</span> <span class="text-gray-500 ml-1 svelte-fo0yqp"> </span></div></div> <div class="flex items-center gap-1.5 svelte-fo0yqp"><!> <!></div></div> <div class="w-full h-2 bg-gray-800 rounded overflow-hidden relative z-10 svelte-fo0yqp"><div class="h-full bg-gradient-to-r from-cyan-500 to-cyan-300 transition-all duration-100 svelte-fo0yqp"></div> <div class="absolute inset-0 bg-white/20 svelte-fo0yqp" style="animation: shimmer 1.5s infinite;"></div></div></div>'),ss=b('<div class="space-y-2 mt-4 svelte-fo0yqp"></div>'),rs=b('<div class="absolute inset-0 pointer-events-none opacity-30 svelte-fo0yqp"></div>'),as=b('<button type="button"><div class="flex justify-center mb-3 svelte-fo0yqp"><div><!> <img/></div></div> <div class="text-center mb-2 svelte-fo0yqp"><div class="text-lg font-bold svelte-fo0yqp"> </div> <div class="text-xs text-gray-400 svelte-fo0yqp"> </div> <!> <div> </div></div> <!> <!></button>'),os=b(`<div class="min-h-screen bg-black text-white p-4 space-y-4 svelte-fo0yqp"><div class="max-w-5xl mx-auto svelte-fo0yqp"><div class="bg-gray-950 border border-gray-800 rounded-xl shadow-2xl svelte-fo0yqp"><div class="flex items-stretch svelte-fo0yqp"><div class="flex-1 px-5 py-3 border-r border-gray-800/50 svelte-fo0yqp"><div class="flex items-baseline gap-3 svelte-fo0yqp"><div class="flex items-center gap-2 svelte-fo0yqp"><div class="w-3 h-3 rounded-sm svelte-fo0yqp" style="background: #cd7f32; box-shadow: 0 0 8px #cd7f32;"></div> <span class="text-2xl font-bold tabular-nums text-white svelte-fo0yqp"> </span></div> <!></div> <div class="text-xs text-gray-500 mt-0.5 uppercase tracking-wider svelte-fo0yqp">Copper</div></div> <div class="px-5 py-3 border-r border-gray-800/50 svelte-fo0yqp"><div class="flex items-center gap-3 svelte-fo0yqp"><div class="text-center svelte-fo0yqp"><div class="text-xl font-bold text-amber-400 svelte-fo0yqp"> </div> <div class="text-xs text-gray-500 uppercase tracking-wider svelte-fo0yqp">Speed</div></div> <button><div> </div> <div> </div></button></div></div> <div class="px-5 py-3 border-r border-gray-800/50 svelte-fo0yqp"><div class="text-center svelte-fo0yqp"><div class="text-xl font-bold text-cyan-400 svelte-fo0yqp"> </div> <div class="text-xs text-gray-500 uppercase tracking-wider svelte-fo0yqp">Active Miners</div></div></div> <div class="px-5 py-3 flex items-center gap-3 svelte-fo0yqp"><!> <div class="flex items-center gap-1.5 svelte-fo0yqp"><div></div> <span class="text-xs text-gray-500 svelte-fo0yqp"> </span></div></div></div></div></div> <div class="container mx-auto pb-8 px-4 svelte-fo0yqp"><div class="max-w-5xl mx-auto svelte-fo0yqp"><div class="grid grid-cols-4 gap-4 svelte-fo0yqp"></div> <div class="mt-8 text-center text-gray-400 font-mono text-sm svelte-fo0yqp">Click a resource node to deploy a miner. Miners loop continuously until
        cancelled.</div></div></div></div>`);function ps(E,S){Ve(S,!0);const w=[{id:"copper",name:"Copper Rock",yield:1,timeMs:4e3,level:1,cost:0,color:"#cd7f32",image:"/copper.png"},{id:"iron",name:"Iron Rock",yield:2,timeMs:6e3,level:10,cost:50,color:"#808080",image:"/iron.png"},{id:"silver",name:"Silver Rock",yield:3,timeMs:8e3,level:25,cost:200,color:"#c0c0c0",image:"/silver.png"},{id:"gold",name:"Gold Rock",yield:5,timeMs:1e4,level:40,cost:500,color:"#ffd700",image:"/gold.png"},{id:"cobalt",name:"Cobalt Rock",yield:8,timeMs:12e3,level:55,cost:1e3,color:"#0047ab",image:"/cobalt.png"},{id:"obsidian",name:"Obsidian Rock",yield:12,timeMs:14e3,level:70,cost:2e3,color:"#4b0082",image:"/obsidian.png"},{id:"astral",name:"Astral Rock",yield:18,timeMs:16e3,level:85,color:"#87ceeb",cost:5e3,image:"/astral.png"},{id:"infernal",name:"Infernal Rock",yield:25,timeMs:18e3,level:100,color:"#ff4500",cost:1e4,image:"/infernal.png"}];let k=P(!1),m=null,_=P(me([])),d=P(me({})),y=P(1),j=P(me(Date.now()));const Ke=s=>Math.floor(500*Math.pow(4,s-1)),Y=4,Xe=2,Qe=f(()=>w.slice(0,Y*Xe).map((s,t)=>({...s,row:Math.floor(t/Y),col:t%Y}))),Ze=f(()=>e(_).filter(s=>s.taskId.startsWith("mission4-"))),q=f(()=>{const s=new Map;for(const t of e(Ze))t.params?.nodeId&&(t.status==="running"||t.status==="pending")&&s.set(t.taskId,{nodeId:t.params.nodeId,startTime:t.startedAt||Date.now(),cycle:t.progress?.cycle||0});return s}),et=f(()=>{const s=new Map;for(const[t,o]of e(q).entries()){const l=w.find(c=>c.id===o.nodeId);if(l){const g=(e(j)-o.startTime)%l.timeMs/l.timeMs;s.set(t,g)}}return s});function tt(s){return e(et).get(s)||0}function z(){const s=e(_).find(t=>t.taskId==="mission4-global-state"||t.taskId==="global-state"&&t.params?.namespace==="mission4");if(s&&s.status==="completed"){Object.keys(e(d)).length===0&&h(d,{copper:0},!0);return}if(s?.progress?.resources!==void 0){const t=s.progress.resources;typeof t=="object"&&t!==null?h(d,t,!0):typeof t=="number"&&h(d,{copper:t},!0)}else Object.keys(e(d)).length===0&&h(d,{copper:0},!0);s?.progress?.speedMultiplier!==void 0&&h(y,s.progress.speedMultiplier,!0)}Ft(()=>{z()});async function C(){try{const s=await He("mission4");ze(()=>{h(_,s,!0)}),await z()}catch(s){console.error("Failed to load tasks:",s)}}const W=5;async function st(s){const t=w.find(c=>c.id===s);if(!t)return;if(ue(s)>=W){alert(`Maximum ${W} miners per node!`);return}const l=e(d).copper||0;if(l<t.cost){alert(`Need ${t.cost} Copper to deploy ${t.name} miner. You have ${l}.`);return}try{await V({taskName:"mine-resource-loop",nodeId:s,namespace:"mission4",yield:t.yield,timeMs:t.timeMs,cost:t.cost}),await C()}catch(c){console.error("Failed to deploy miner:",c);const g=c instanceof Error?c.message:String(c);alert("Failed to deploy miner: "+g)}}const rt=2;function B(s){const t=e(q).get(s);if(!t)return 0;const o=w.find(c=>c.id===t.nodeId);return o?t.cycle*o.yield*rt:0}async function at(s){if(!e(q).get(s))return;const o=B(s);if(o===0){alert("This miner hasn't generated any resources yet!");return}if(await confirm(`Sell miner for ${o.toLocaleString()} Copper?`))try{await V({taskName:"sell-miner",namespace:"mission4",taskIdToCancel:s,copperToAdd:o}),await C()}catch(l){console.error("Failed to sell miner:",l),alert("Failed to sell miner: "+(l instanceof Error?l.message:String(l)))}}function ue(s){return Array.from(e(q).values()).filter(t=>t.nodeId===s).length}const ye=f(()=>{let s=0;for(const t of e(q).values()){const o=w.find(l=>l.id===t.nodeId);o&&(s+=o.yield/o.timeMs*1e3*e(y))}return s}),K=f(()=>Ke(e(y))),A=f(()=>(e(d).copper||0)>=e(K));async function ot(){if(e(A))try{await V({taskName:"speed-upgrade",namespace:"mission4",cost:e(K)}),await C()}catch(s){console.error("Failed to upgrade speed:",s),alert("Failed to upgrade: "+(s instanceof Error?s.message:String(s)))}}async function it(){const s=Array.from(e(q).keys()).filter(t=>t!=="mission4-global-state");if(s.length!==0&&await confirm(`Cancel all ${s.length} miners?`)){for(const t of s)await Je(t);await C()}}Gt(()=>{C();const s=window.location.protocol==="https:"?"wss:":"ws:",t=window.location.host,o=`${s}//${t}/ws`;m=Jt(o,$=>{$.type==="tasks"&&ze(()=>{h(_,$.data.filter(x=>x.taskId.startsWith("mission4-")||x.taskId==="global-state"),!0),z()})},()=>{h(k,!0)},()=>{h(k,!1)}).close;const c=async()=>{try{const x=(await He("mission4")).find(D=>D.taskId==="mission4-global-state"||D.taskId==="global-state"&&D.params?.namespace==="mission4");!x||x.status==="completed"||x.status==="failed"?(x&&await Je(x.taskId),await V({taskName:"global-state",namespace:"mission4"}),await C()):z()}catch{}};setTimeout(()=>c(),500);const g=setInterval(()=>{h(j,Date.now(),!0)},100),O=setInterval(()=>{C()},500);return()=>{clearInterval(g),clearInterval(O),m?.()}});var X=os();Bt("fo0yqp",s=>{Pt(()=>{Ut.title="Mining Game - ironalarm"})});var Q=a(X),xe=a(Q),be=a(xe),Z=a(be),_e=a(Z),ee=a(_e),he=i(a(ee),2),lt=a(he,!0);r(he),r(ee);var nt=i(ee,2);{var dt=s=>{var t=Yt(),o=a(t);r(t),M(l=>p(o,`+${l??""}/s`),[()=>e(ye).toFixed(1)]),u(s,t)};R(nt,s=>{e(ye)>0&&s(dt)})}r(_e),U(2),r(Z);var te=i(Z,2),we=a(te),se=a(we),ke=a(se),ct=a(ke);r(ke),U(2),r(se);var L=i(se,2);L.__click=ot;var H=a(L),vt=a(H);r(H);var re=i(H,2),pt=a(re);r(re),r(L),r(we),r(te);var ae=i(te,2),qe=a(ae),$e=a(qe),ft=a($e,!0);r($e),U(2),r(qe),r(ae);var Me=i(ae,2),Ie=a(Me);{var mt=s=>{var t=Kt();t.__click=it,u(s,t)};R(Ie,s=>{e(q).size>0&&s(mt)})}var oe=i(Ie,2),Se=a(oe),Ce=i(Se,2),gt=a(Ce,!0);r(Ce),r(oe),r(Me),r(be),r(xe),r(Q);var Te=i(Q,2),Re=a(Te),Ne=a(Re);We(Ne,21,()=>e(Qe),Be,(s,t)=>{const o=f(()=>ue(e(t).id)),l=f(()=>Array.from(e(q).entries()).filter(([n,v])=>v.nodeId===e(t).id)),c=f(()=>e(o)>=W);var g=as();g.__click=()=>{e(c)?alert(`Maximum ${W} miners per node!`):e(d).copper>=e(t).cost?st(e(t).id):alert(`Need ${e(t).cost} Copper to deploy ${e(t).name} miner`)};var O=a(g),$=a(O),x=a($);{var D=n=>{var v=Xt();M(()=>N(v,`background: radial-gradient(circle, ${e(t).color??""} 0%, transparent 70%); animation: pulse 2s ease-in-out infinite;`)),u(n,v)};R(x,n=>{e(o)>0&&n(D)})}var ie=i(x,2);r($),r(O);var le=i(O,2),J=a(le),ut=a(J,!0);r(J);var ne=i(J,2),yt=a(ne);r(ne);var Ee=i(ne,2);{var xt=n=>{var v=Qt(),ce=a(v);r(v),M(()=>p(ce,`Cost: ${e(t).cost??""} Copper`)),u(n,v)},bt=n=>{var v=Zt();u(n,v)};R(Ee,n=>{e(t).cost>0?n(xt):n(bt,!1)})}var de=i(Ee,2),_t=a(de);r(de),r(le);var Ae=i(le,2);{var ht=n=>{var v=ss();We(v,21,()=>e(l),Be,(ce,qt)=>{var Le=f(()=>jt(e(qt),2));let F=()=>e(Le)[0],$t=()=>e(Le)[1];const Mt=f(()=>tt(F()));var ve=ts(),Oe=a(ve),pe=i(Oe,2),fe=a(pe),De=i(a(fe),2),Fe=i(a(De),2),It=a(Fe);r(Fe),r(De),r(fe);var Ge=i(fe,2),Pe=a(Ge);{var St=G=>{var T=es(),je=a(T,!0);r(T),M(Rt=>p(je,Rt),[()=>B(F()).toLocaleString()]),u(G,T)};R(Pe,G=>{B(F())>0&&G(St)})}var Ct=i(Pe,2);{let G=f(()=>`Sell for ${B(F()).toLocaleString()} Copper`);Ht(Ct,{size:"icon",variant:"ghost",onclick:T=>{T.stopPropagation(),at(F())},class:"h-6 w-6 text-green-400 hover:bg-green-900/30 transition-all hover:scale-110",get title(){return e(G)},children:(T,je)=>{Vt(T,{class:"w-3 h-3"})},$$slots:{default:!0}})}r(Ge),r(pe);var Ue=i(pe,2),Tt=a(Ue);U(2),r(Ue),r(ve),M(()=>{N(Oe,`background: linear-gradient(90deg, transparent 0%, ${e(t).color??""} 50%, transparent 100%); animation: mining-sweep 2s linear infinite;`),p(It,`x${$t().cycle??""}`),N(Tt,`width: ${e(Mt)*100}%; box-shadow: 0 0 8px ${e(t).color??""};`)}),u(ce,ve)}),r(v),u(n,v)};R(Ae,n=>{e(o)>0&&n(ht)})}var wt=i(Ae,2);{var kt=n=>{var v=rs();M(()=>N(v,`background: radial-gradient(circle, ${e(t).color??""} 0%, transparent 70%); animation: pulse 2s ease-in-out infinite;`)),u(n,v)};R(wt,n=>{e(o)>0&&n(kt)})}r(g),M(()=>{I(g,1,`relative border-2 rounded-lg p-4 transition-all hover:scale-105 cursor-pointer text-left w-full ${e(o)>0?"border-green-500 bg-green-950/30 shadow-lg":"border-gray-600 bg-gray-900/50"} ${e(d).copper>=e(t).cost&&!e(c)?"hover:border-cyan-400":"opacity-60"}`,"svelte-fo0yqp"),N(g,`border-color: ${e(t).color??""}; box-shadow: ${e(o)>0?`0 0 20px ${e(t).color}40`:"none"};`),I($,1,`relative w-20 h-20 rounded-xl border-2 p-2 bg-gradient-to-br from-black/40 to-black/60 flex items-center justify-center transition-all duration-300 ${e(o)>0?"shadow-2xl scale-105":""}`,"svelte-fo0yqp"),N($,`border-color: ${(e(o)>0?e(t).color:"#4b5563")??""}; box-shadow: ${e(o)>0?`0 0 20px ${e(t).color}60, inset 0 0 20px ${e(t).color}20`:"none"};`),ge(ie,"src",e(t).image),ge(ie,"alt",e(t).name),I(ie,1,`relative z-10 w-full h-full object-contain drop-shadow-2xl filter ${e(o)>0?"brightness-110":""}`,"svelte-fo0yqp"),N(J,`color: ${e(t).color??""}`),p(ut,e(t).name),p(yt,`Yield: ${e(t).yield??""} | Time: ${e(t).timeMs/1e3}s`),I(de,1,`text-xs mt-1 ${e(c)?"text-red-400":"text-gray-500"}`,"svelte-fo0yqp"),p(_t,`${e(o)??""}/5 miners`)}),u(s,g)}),r(Ne),U(2),r(Re),r(Te),r(X),M((s,t)=>{p(lt,s),p(ct,`${e(y)??""}x`),L.disabled=!e(A),I(L,1,`group relative px-4 py-2 rounded-lg transition-all duration-200 ${e(A)?"bg-amber-500/10 hover:bg-amber-500/20 border border-amber-500/50 hover:border-amber-400":"bg-gray-800/50 border border-gray-700 opacity-50 cursor-not-allowed"}`,"svelte-fo0yqp"),I(H,1,`text-sm font-semibold ${e(A)?"text-amber-400":"text-gray-500"}`,"svelte-fo0yqp"),p(vt,`Upgrade to ${e(y)+1}x`),I(re,1,`text-xs ${e(A)?"text-amber-500/70":"text-gray-600"}`,"svelte-fo0yqp"),p(pt,`${t??""} copper`),p(ft,e(q).size),ge(oe,"title",e(k)?"Connected":"Disconnected"),I(Se,1,`w-2 h-2 rounded-full ${e(k)?"bg-emerald-500 shadow-lg shadow-emerald-500/50":"bg-red-500"}`,"svelte-fo0yqp"),p(gt,e(k)?"Live":"Offline")},[()=>(e(d).copper||0).toLocaleString(),()=>e(K).toLocaleString()]),u(E,X),Ye()}Lt(["click"]);export{ps as component};
